<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>ArcGIS API for JavaScript Sample</title>

    <style>
      html,
      body,
      #viewDiv {
        padding: 0;
        margin: 0;
        height: 100%;
        width: 100%;
      }
	  
	  #relationshipResults {
            width: 175px;
            padding: 10px;
        }
    </style>

    <link rel="stylesheet" href="https://js.arcgis.com/4.23/esri/themes/light/main.css">
    <script src="https://js.arcgis.com/4.23/"></script>
    <script>
      require([
	"esri/config",
	"esri/Map", 
	"esri/views/MapView",
	"esri/widgets/Locate",
	"esri/widgets/Track",
    "esri/Graphic",
	"esri/layers/GraphicsLayer",
	"esri/rest/route",
     "esri/rest/support/RouteParameters",
     "esri/rest/support/FeatureSet",
	 //"esri/widgets/Sketch",
	 "esri/widgets/Sketch/SketchViewModel",
     "esri/geometry/geometryEngine",
	], function (
	    esriConfig,
	    Map, 
	    MapView,
	    Locate,
	    Track,
	    Graphic,
	    GraphicsLayer,
		route,
		RouteParameters,
		FeatureSet,
		//Sketch,
		SketchViewModel,
		geometryEngine,
	) {
	esriConfig.apiKey = "AAPK27a87d0d60324752b3355336ec594a8esj7hc2RkLc_6YKWVOMGlTWjB-faYCQuJR4TzIhh-5vhY8qPIrZ0G_FsdonoQRz-n";

        const map = new Map({
          basemap: "arcgis-navigation" // Basemap layer service
        });

	const view = new MapView({
          map: map,
          center: [-118.24532,34.05398], //Longitude, latitude
		  zoom: 12, // Zoom level
          container: "viewDiv" // Div element
        });
		
	const relationshipDiv = document.getElementById("relationshipResults");
    view.ui.add(relationshipDiv, "bottom-right");
	
	const graphicsLayer = new GraphicsLayer();
	map.add(graphicsLayer);
	
	const graphicsLayerSketch = new GraphicsLayer();
	map.add(graphicsLayerSketch);
	
	const polyline = {
                type: "polyline",
                paths: [
                    [-13227000.704542402, 4032506.197638312],
                    [-13223540.698857695, 4034443.92109266],
                    [-13222135.94452635, 4032506.197638312],
                    [-13221470.479577951, 4033494.9524006792],
                    [-13221470.404932415, 4033494.9524006792]
                ],
                /*spatialReference: {
                    wkid: 102100
                }*/
            };
			
			const popupTemplateTestPop = {
		title: "{Name}",
		content: "{Description}"
	 }
	 const attributesTestPop = {
		Name: "Test Pop",
		Description: "I am a test pop"
	 }
			
            const simpleLineSymbol = {
                type: "simple-line",
                width: 2
            };
            const polylineGraphic = new Graphic({
                geometry: polyline,
                symbol: simpleLineSymbol,
				attributes: attributesTestPop,
				popupTemplate: popupTemplateTestPop,
            });
            graphicsLayer.add(polylineGraphic);
			
			// Create a polygon geometry
            const polygon = {
                type: "polygon",
                rings: [
                    [-13228098.704542402, 4035365.9427463487],
                    [-13226362.225451587, 4035365.9427463487],
                    [-13226362.225451587, 4032059.2948176656],
                    [-13228098.704542402, 4032059.2948176656],
                    [-13228098.704542402, 4035365.9427463487]
                ],
                /*spatialReference: {
                    wkid: 102100
                }*/
            };
            const simpleFillSymbol = {
                type: "simple-fill"
            };
            const polygonGraphic = new Graphic({
                geometry: polygon,
                symbol: simpleFillSymbol,
				attributes: attributesTestPop,
				popupTemplate: popupTemplateTestPop,
            });

            graphicsLayer.add(polygonGraphic);
			
			let selectedGraphics = [polygonGraphic, polylineGraphic];
			
			const sketch = new Sketch({
                view: view,
                layer: graphicsLayer,
                updateOnGraphicClick: false,
                snappingOptions: {
                    enabled: false,
                    featureSources: [{
                        layer: graphicsLayerSketch
                    }]
                },
                visibleElements: {
                    createTools: {
                        point: false
                    },
                    selectionTools: {
                        "lasso-selection": true,
                        "rectangle-selection": true,
                    },
                    settingsMenu: true,
                    undoRedoMenu: true
                }
            });
			
			view.ui.add(sketch, "top-right");
			
			sketch.on(["update", "undo", "redo"], onGraphicUpdate);
			
			sketch.on("create", (event) => {
                if (event.state === "start") {
                    const arrVal = selectedGraphics.pop();
                    graphicsLayer.remove(arrVal);
                }
                if (event.state === "complete") {
                    selectedGraphics.unshift(event.graphic);
					onGraphicUpdate();
                }
            })
			
			view.when(() => {
                sketch.update(polylineGraphic).then(onGraphicUpdate)
            });
			
			function onGraphicUpdate() {
                let geometry1 = selectedGraphics[0].geometry;
                let geometry2 = selectedGraphics[1].geometry;

                const contains = geometryEngine.contains(geometry1, geometry2);
                showSpatialRelationship("Contains", contains)

                const crosses = geometryEngine.crosses(geometry1, geometry2);
                showSpatialRelationship("Crosses", crosses)

                const disjoint = geometryEngine.disjoint(geometry1, geometry2);
                showSpatialRelationship("Disjoint", disjoint)

                const equals = geometryEngine.equals(geometry1, geometry2);
                showSpatialRelationship("Equals", equals)

                const intersects = geometryEngine.intersects(geometry1, geometry2);
                showSpatialRelationship("Intersects", intersects)

                const overlaps = geometryEngine.overlaps(geometry1, geometry2);
                showSpatialRelationship("Overlaps", overlaps)

                const touches = geometryEngine.touches(geometry1, geometry2);
                showSpatialRelationship("Touches", touches)

                const within = geometryEngine.within(geometry1, geometry2);
                showSpatialRelationship("Within", within)

            }
			
			function showSpatialRelationship(string, value) {
                const element = document.getElementById(string)
                if (value) {
                  element.innerHTML =   "<b>" + string + ": " + value + "</b>";
                } else {
                 element.innerHTML = string + ": " + value;
                }
            }

/*
    const routeUrl = "https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World";
	
	view.on("click", function(event){
	if (view.graphics.length === 0) {
			addGraphic("origin", event.mapPoint);
		  } else if (view.graphics.length === 1) {
			addGraphic("destination", event.mapPoint);
			
			getRoute(); // Call the route service

		  } else {
			view.graphics.removeAll();
			addGraphic("origin",event.mapPoint);
		  }
    });
*/
    function addGraphic(type, point) {
      const graphic = new Graphic({
        symbol: {
          type: "simple-marker",
          color: (type === "origin") ? "white" : "black",
          size: "8px"
        },
        geometry: point
      });
      view.graphics.add(graphic);
    }
	
	function getRoute() {
      const routeParams = new RouteParameters({
        stops: new FeatureSet({
          features: view.graphics.toArray()
        }),
		returnDirections: true
      });
	  
	  route.solve(routeUrl, routeParams)
        .then(function(data) {
          data.routeResults.forEach(function(result) {
            result.route.symbol = {
              type: "simple-line",
              color: [5, 150, 255],
              width: 3
            };
            view.graphics.add(result.route);
          });

			// Display directions
         if (data.routeResults.length > 0) {
           const directions = document.createElement("ol");
           directions.classList = "esri-widget esri-widget--panel esri-directions__scroller";
           directions.style.marginTop = "0";
           directions.style.padding = "15px 15px 15px 30px";
           const features = data.routeResults[0].directions.features;

			// Show each direction
           features.forEach(function(result,i){
             const direction = document.createElement("li");
             direction.innerHTML = result.attributes.text + " (" + result.attributes.length.toFixed(2) + " miles)";
             directions.appendChild(direction);
           });
		   
		   //view.ui.empty("top-right");
          //view.ui.add(directions, "top-right");
         }
        })
		.catch(function(error){
			console.log(error);
		})
    }
	
	const graphicsLayerPop = new GraphicsLayer();
	map.add(graphicsLayerPop);

	const point = { //Create a point
		type: "point",
		longitude: -118.80657463861,
		latitude: 34.0005930608889
	 };
	 const simpleMarkerSymbol = {
		type: "simple-marker",
		color: [226, 119, 40],  // Orange
		outline: {
			color: [255, 255, 255], // White
			width: 1
		}
	 };
	 
	const pointGraphic = new Graphic({
		geometry: point,
		symbol: simpleMarkerSymbol
	 });
	 graphicsLayerPop.add(pointGraphic);
	 
	 // Create a line geometry
	 const polylineX = {
		type: "polyline",
		paths: [
			[-118.821527826096, 34.0139576938577], //Longitude, latitude
			[-118.814893761649, 34.0080602407843], //Longitude, latitude
			[-118.808878330345, 34.0016642996246]  //Longitude, latitude
		]
	 };
	 /*
	 const simpleLineSymbol = {
		type: "simple-line",
		color: [226, 119, 40], // Orange
		width: 2
	 };
	 */
	 const popupTemplate = {
		title: "{Name}",
		content: "{Description}"
	 }
	 const attributesLine = {
		Name: "Line",
		Description: "I am a Line"
	 }
	 
	const polylineGraphicX = new Graphic({
		geometry: polylineX,
		symbol: simpleLineSymbol,
		attributes: attributesLine,
		popupTemplate: popupTemplate
	 });
	 graphicsLayerPop.add(polylineGraphicX);
	 
	 // Create a polygon geometry
	 const polygonX1 = {
		type: "polygon",
		rings: [
			[-118.818984489994, 34.0137559967283], //Longitude, latitude
			[-118.806796597377, 34.0215816298725], //Longitude, latitude
			[-118.791432890735, 34.0163883241613], //Longitude, latitude
			[-118.79596686535, 34.008564864635],   //Longitude, latitude
			[-118.808558110679, 34.0035027131376]  //Longitude, latitude
		]
	 };
	 
	 // Create a polygon geometry
	 const polygon2 = {
		type: "polygon",
		rings: [
			[-118.818984489999, 34.0137559967283], //Longitude, latitude
			[-118.806796597379, 34.0215816298725], //Longitude, latitude
			[-118.791432890739, 34.0163883241613], //Longitude, latitude
			[-118.795966865359, 34.008564864635],   //Longitude, latitude
			[-119.808558110679, 34.0035027131376]  //Longitude, latitude
		]
	 };
/*
	 const simpleFillSymbol = {
		type: "simple-fill",
		color: [227, 139, 79, 0.8],  // Orange, opacity 80%
		outline: {
			color: [255, 255, 255],
			width: 1
		}
	 };
	*/ 
	 const attributes = {
		Name: "Graphic",
		Description: "I am a polygon"
	 }
	 
	 const attributes2 = {
		Name: "Graphic2",
		Description: "I am a polygon 2"
	 }

	 const polygonGraphicX1 = new Graphic({
		geometry: polygonX1,
		symbol: simpleFillSymbol,
		attributes: attributes,
		popupTemplate: popupTemplate
	 });
	 
	 const polygonGraphic2 = new Graphic({
		geometry: polygon2,
		symbol: simpleFillSymbol,
		attributes: attributes2,
		popupTemplate: popupTemplate
	 });
	 
	 
	 graphicsLayerPop.add(polygonGraphicX1);
	 graphicsLayerPop.add(polygonGraphic2);
/*
	const locate = new Locate({
          view: view,
          useHeadingEnabled: false,
          goToOverride: function(view, options) {
            options.target.scale = 1500;
            return view.goTo(options.target);
          }
        });
        view.ui.add(locate, "top-left");
*/
	const track = new Track({
          view: view,
          graphic: new Graphic({
            symbol: {
              type: "simple-marker",
              size: "12px",
              color: "green",
              outline: {
                color: "#efefef",
                width: "1.5px"
              }
            }
          }),
          useHeadingEnabled: false
        });
        view.ui.add(track, "top-left");
      });
    </script>
  </head>
  <body>
    <div id="viewDiv"></div>
	<div id="relationshipResults" class="esri-widget">
        <div><b>Spatial relationships</b></div>
        <div id="Contains"></div>
        <div id="Crosses"></div>
        <div id="Disjoint"></div>
        <div id="Equals"></div>
        <div id="Intersects"></div>
        <div id="Overlaps"></div>
        <div id="Touches"></div>
        <div id="Within"></div>
    </div>
  </body>
</html>
