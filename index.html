<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>ArcGIS API for JavaScript Tutorials: Display a map</title>

    <style>
      html,
      body,
      #viewDiv {
        padding: 0;
        margin: 0;
        height: 100%;
        width: 100%;
      }
    </style>

    <link rel="stylesheet" href="https://js.arcgis.com/4.23/esri/themes/light/main.css">
    <script src="https://js.arcgis.com/4.23/"></script>
    <script>
      require([
	"esri/config",
	"esri/Map", 
	"esri/views/MapView",
	"esri/widgets/Locate",
	"esri/widgets/Track",
    "esri/Graphic",
	"esri/layers/GraphicsLayer",
	"esri/rest/route",
      "esri/rest/support/RouteParameters",
      "esri/rest/support/FeatureSet",
	], function (
	    esriConfig,
	    Map, 
	    MapView,
	    Locate,
	    Track,
	    Graphic,
	    GraphicsLayer,
		route,
		RouteParameters,
		FeatureSet,
	) {
	esriConfig.apiKey = "AAPK27a87d0d60324752b3355336ec594a8esj7hc2RkLc_6YKWVOMGlTWjB-faYCQuJR4TzIhh-5vhY8qPIrZ0G_FsdonoQRz-n";

        const map = new Map({
          basemap: "arcgis-navigation" // Basemap layer service
        });

	const view = new MapView({
          map: map,
          center: [-118.24532,34.05398], //Longitude, latitude
		  zoom: 12, // Zoom level
          container: "viewDiv" // Div element
        });

    const routeUrl = "https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World";
	
	view.on("click", function(event){
	if (view.graphics.length === 0) {
			addGraphic("origin", event.mapPoint);
		  } else if (view.graphics.length === 1) {
			addGraphic("destination", event.mapPoint);
			
			getRoute(); // Call the route service

		  } else {
			view.graphics.removeAll();
			addGraphic("origin",event.mapPoint);
		  }
    });

    function addGraphic(type, point) {
      const graphic = new Graphic({
        symbol: {
          type: "simple-marker",
          color: (type === "origin") ? "white" : "black",
          size: "8px"
        },
        geometry: point
      });
      view.graphics.add(graphic);
    }
	
	function getRoute() {
      const routeParams = new RouteParameters({
        stops: new FeatureSet({
          features: view.graphics.toArray()
        }),
		returnDirections: true
      });
	  
	  route.solve(routeUrl, routeParams)
        .then(function(data) {
          data.routeResults.forEach(function(result) {
            result.route.symbol = {
              type: "simple-line",
              color: [5, 150, 255],
              width: 3
            };
            view.graphics.add(result.route);
          });

			// Display directions
         if (data.routeResults.length > 0) {
           const directions = document.createElement("ol");
           directions.classList = "esri-widget esri-widget--panel esri-directions__scroller";
           directions.style.marginTop = "0";
           directions.style.padding = "15px 15px 15px 30px";
           const features = data.routeResults[0].directions.features;

			// Show each direction
           features.forEach(function(result,i){
             const direction = document.createElement("li");
             direction.innerHTML = result.attributes.text + " (" + result.attributes.length.toFixed(2) + " miles)";
             directions.appendChild(direction);
           });
		   
		   view.ui.empty("top-right");
          view.ui.add(directions, "top-right");
         }
        })
		.catch(function(error){
			console.log(error);
		})
    }
	
	const graphicsLayer = new GraphicsLayer();
	map.add(graphicsLayer);

	const point = { //Create a point
		type: "point",
		longitude: -118.80657463861,
		latitude: 34.0005930608889
	 };
	 const simpleMarkerSymbol = {
		type: "simple-marker",
		color: [226, 119, 40],  // Orange
		outline: {
			color: [255, 255, 255], // White
			width: 1
		}
	 };
	 
	const pointGraphic = new Graphic({
		geometry: point,
		symbol: simpleMarkerSymbol
	 });
	 graphicsLayer.add(pointGraphic);
	 
	 // Create a line geometry
	 const polyline = {
		type: "polyline",
		paths: [
			[-118.821527826096, 34.0139576938577], //Longitude, latitude
			[-118.814893761649, 34.0080602407843], //Longitude, latitude
			[-118.808878330345, 34.0016642996246]  //Longitude, latitude
		]
	 };
	 const simpleLineSymbol = {
		type: "simple-line",
		color: [226, 119, 40], // Orange
		width: 2
	 };
	 
	 const popupTemplate = {
		title: "{Name}",
		content: "{Description}"
	 }
	 const attributesLine = {
		Name: "Line",
		Description: "I am a Line"
	 }
	 
	const polylineGraphic = new Graphic({
		geometry: polyline,
		symbol: simpleLineSymbol,
		attributes: attributesLine,
		popupTemplate: popupTemplate
	 });
	 graphicsLayer.add(polylineGraphic);
	 
	 // Create a polygon geometry
	 const polygon = {
		type: "polygon",
		rings: [
			[-118.818984489994, 34.0137559967283], //Longitude, latitude
			[-118.806796597377, 34.0215816298725], //Longitude, latitude
			[-118.791432890735, 34.0163883241613], //Longitude, latitude
			[-118.79596686535, 34.008564864635],   //Longitude, latitude
			[-118.808558110679, 34.0035027131376]  //Longitude, latitude
		]
	 };
	 
	 // Create a polygon geometry
	 const polygon2 = {
		type: "polygon",
		rings: [
			[-118.818984489999, 34.0137559967283], //Longitude, latitude
			[-118.806796597379, 34.0215816298725], //Longitude, latitude
			[-118.791432890739, 34.0163883241613], //Longitude, latitude
			[-118.795966865359, 34.008564864635],   //Longitude, latitude
			[-119.808558110679, 34.0035027131376]  //Longitude, latitude
		]
	 };

	 const simpleFillSymbol = {
		type: "simple-fill",
		color: [227, 139, 79, 0.8],  // Orange, opacity 80%
		outline: {
			color: [255, 255, 255],
			width: 1
		}
	 };
	 
	 const attributes = {
		Name: "Graphic",
		Description: "I am a polygon"
	 }
	 
	 const attributes2 = {
		Name: "Graphic2",
		Description: "I am a polygon 2"
	 }

	 const polygonGraphic = new Graphic({
		geometry: polygon,
		symbol: simpleFillSymbol,
		attributes: attributes,
		popupTemplate: popupTemplate
	 });
	 
	 const polygonGraphic2 = new Graphic({
		geometry: polygon2,
		symbol: simpleFillSymbol,
		attributes: attributes2,
		popupTemplate: popupTemplate
	 });
	 
	 
	 graphicsLayer.add(polygonGraphic);
	 graphicsLayer.add(polygonGraphic2);
/*
	const locate = new Locate({
          view: view,
          useHeadingEnabled: false,
          goToOverride: function(view, options) {
            options.target.scale = 1500;
            return view.goTo(options.target);
          }
        });
        view.ui.add(locate, "top-left");
*/
	const track = new Track({
          view: view,
          graphic: new Graphic({
            symbol: {
              type: "simple-marker",
              size: "12px",
              color: "green",
              outline: {
                color: "#efefef",
                width: "1.5px"
              }
            }
          }),
          useHeadingEnabled: false
        });
        view.ui.add(track, "top-left");
      });
    </script>
  </head>
  <body>
    <div id="viewDiv"></div>
  </body>
</html>
